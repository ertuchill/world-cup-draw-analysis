<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WC 2026 - Analysis Center</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Oswald:wght@400;700&family=Roboto:wght@300;400;700&display=swap');
        
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #0f172a;
            color: white;
            height: 100vh;
            overflow: hidden; 
        }
        
        h1, h2, h3 { font-family: 'Oswald', sans-serif; text-transform: uppercase; }

        .sidebar {
            background: rgba(15, 23, 42, 0.95);
            border-right: 1px solid #334155;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .country-item {
            cursor: pointer;
            transition: all 0.2s;
            border-left: 3px solid transparent;
        }
        .country-item:hover {
            background-color: #1e293b;
            border-left-color: #ca8a04;
        }
        .country-item.active {
            background: linear-gradient(90deg, #ca8a04 0%, transparent 100%);
            border-left-color: white;
            color: white;
        }
        .country-item.active span { color: white !important; }

        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #0f172a; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #475569; }

        .progress-bar { transition: width 1s ease-in-out; }
    </style>
</head>
<body class="flex">

    <aside class="w-1/4 min-w-[320px] sidebar z-10 shadow-2xl">
        <div class="p-6 border-b border-gray-700 bg-slate-900">
            <h2 class="text-2xl text-yellow-500 font-bold mb-1"><i class="fas fa-chart-pie mr-2"></i> ANALYSIS</h2>
            <p class="text-xs text-gray-400">OPPONENT STATISTICS</p>
            
            <div class="mt-4 relative">
                <input type="text" id="searchInput" onkeyup="filterCountries()" placeholder="Search Country..." 
                    class="w-full bg-slate-800 border border-gray-600 rounded p-2 pl-8 text-sm text-gray-300 focus:outline-none focus:border-yellow-500">
                <i class="fas fa-search absolute left-3 top-3 text-gray-500 text-xs"></i>
            </div>
        </div>

        <div id="countryList" class="flex-1 overflow-y-auto"></div>

        <div class="p-4 border-t border-gray-700 bg-slate-900">
            <a href="/" class="flex items-center justify-center gap-2 text-sm text-gray-400 hover:text-white transition">
                <i class="fas fa-home"></i> Back to Home
            </a>
        </div>
    </aside>

    <main class="w-3/4 h-full bg-gradient-to-br from-slate-900 to-slate-800 relative overflow-y-auto">
        <div class="absolute top-0 right-0 p-10 opacity-5 pointer-events-none">
            <i class="fas fa-globe-americas text-9xl"></i>
        </div>

        <div class="p-10 max-w-5xl mx-auto">
            <div id="headerSection" class="mb-10 flex items-center gap-6 fade-in">
                <div class="w-20 h-20 rounded-full bg-slate-700 flex items-center justify-center text-3xl shadow-lg border-2 border-yellow-500">
                    <i class="fas fa-flag text-gray-300"></i>
                </div>
                <div>
                    <h1 id="selectedCountryName" class="text-5xl font-bold text-white mb-2">SELECT A COUNTRY</h1>
                    <span id="selectedCountryPot" class="bg-gray-700 text-gray-300 px-3 py-1 rounded text-sm font-mono border border-gray-600">---</span>
                </div>
            </div>

            <div id="statsSection" class="bg-slate-800/50 backdrop-blur-md rounded-xl border border-gray-700 overflow-hidden shadow-xl hidden">
                <div class="p-4 bg-slate-900/80 border-b border-gray-700 flex justify-between items-center">
                    <h3 class="text-yellow-500 font-bold">POSSIBLE OPPONENTS & PROBABILITIES</h3>
                    <span class="text-xs text-gray-500"><i class="fas fa-info-circle"></i> Based on Simulation Data</span>
                </div>
                
                <div class="p-6">
                    <table class="w-full text-left border-collapse">
                        <thead>
                            <tr class="text-gray-400 text-sm border-b border-gray-700">
                                <th class="py-3 px-4">OPPONENT</th>
                                <th class="py-3 px-4">CONFEDERATION</th>
                                <th class="py-3 px-4 w-1/2">PROBABILITY (%)</th>
                            </tr>
                        </thead>
                        <tbody id="opponentsTableBody" class="text-gray-200"></tbody>
                    </table>
                </div>
            </div>

            <div id="emptyState" class="text-center text-gray-500 mt-20">
                <i class="fas fa-chart-bar text-6xl mb-4 opacity-20"></i>
                <p>Select a country from the list to view analysis.</p>
                <p class="text-xs text-yellow-600 mt-2" id="dataWarning" style="display:none;">
                    <i class="fas fa-exclamation-triangle"></i> 'analysis_data.js' not found.
                </p>
            </div>
        </div>
    </main>

    <script src="{{ url_for('static', filename='analysis_data.js') }}"></script>

    <script>
        // --- DATASET & LOGIC ---
        const allCountries = [
            { name: "Mexico", pot: "Pot 1", kita: "NA", code: "mx" }, { name: "Canada", pot: "Pot 1", kita: "NA", code: "ca" }, { name: "USA", pot: "Pot 1", kita: "NA", code: "us" },
            { name: "Spain", pot: "Pot 1", kita: "EU", code: "es" }, { name: "Argentina", pot: "Pot 1", kita: "SA", code: "ar" }, { name: "France", pot: "Pot 1", kita: "EU", code: "fr" },
            { name: "England", pot: "Pot 1", kita: "EU", code: "gb-eng" }, { name: "Brazil", pot: "Pot 1", kita: "SA", code: "br" }, { name: "Portugal", pot: "Pot 1", kita: "EU", code: "pt" },
            { name: "Netherlands", pot: "Pot 1", kita: "EU", code: "nl" }, { name: "Belgium", pot: "Pot 1", kita: "EU", code: "be" }, { name: "Germany", pot: "Pot 1", kita: "EU", code: "de" },
            { name: "Croatia", pot: "Pot 2", kita: "EU", code: "hr" }, { name: "Morocco", pot: "Pot 2", kita: "AF", code: "ma" }, { name: "Colombia", pot: "Pot 2", kita: "SA", code: "co" },
            { name: "Uruguay", pot: "Pot 2", kita: "SA", code: "uy" }, { name: "Switzerland", pot: "Pot 2", kita: "EU", code: "ch" }, { name: "Japan", pot: "Pot 2", kita: "AS", code: "jp" },
            { name: "Senegal", pot: "Pot 2", kita: "AF", code: "sn" }, { name: "IR Iran", pot: "Pot 2", kita: "AS", code: "ir" }, { name: "Korea Republic", pot: "Pot 2", kita: "AS", code: "kr" },
            { name: "Ecuador", pot: "Pot 2", kita: "SA", code: "ec" }, { name: "Austria", pot: "Pot 2", kita: "EU", code: "at" }, { name: "Australia", pot: "Pot 2", kita: "AS", code: "au" },
            { name: "Norway", pot: "Pot 3", kita: "EU", code: "no" }, { name: "Panama", pot: "Pot 3", kita: "NA", code: "pa" }, { name: "Egypt", pot: "Pot 3", kita: "AF", code: "eg" },
            { name: "Algeria", pot: "Pot 3", kita: "AF", code: "dz" }, { name: "Scotland", pot: "Pot 3", kita: "EU", code: "gb-sct" }, { name: "Paraguay", pot: "Pot 3", kita: "SA", code: "py" },
            { name: "Tunisia", pot: "Pot 3", kita: "AF", code: "tn" }, { name: "Côte d'Ivoire", pot: "Pot 3", kita: "AF", code: "ci" }, { name: "Uzbekistan", pot: "Pot 3", kita: "AS", code: "uz" },
            { name: "Qatar", pot: "Pot 3", kita: "AS", code: "qa" }, { name: "Saudi Arabia", pot: "Pot 3", kita: "AS", code: "sa" }, { name: "South Africa", pot: "Pot 3", kita: "AF", code: "za" },
            { name: "Jordan", pot: "Pot 4", kita: "AS", code: "jo" }, { name: "Cabo Verde", pot: "Pot 4", kita: "AF", code: "cv" }, { name: "Ghana", pot: "Pot 4", kita: "AF", code: "gh" },
            { name: "Curaçao", pot: "Pot 4", kita: "NA", code: "cw" }, { name: "Haiti", pot: "Pot 4", kita: "NA", code: "ht" }, { name: "New Zealand", pot: "Pot 4", kita: "OC", code: "nz" },
            { name: "Italy", pot: "UEFA Path A", kita: "EU", code: "it" }, { name: "N. Ireland", pot: "UEFA Path A", kita: "EU", code: "gb-nir" }, { name: "Wales", pot: "UEFA Path A", kita: "EU", code: "gb-wls" }, { name: "Bosnia & Herz.", pot: "UEFA Path A", kita: "EU", code: "ba" },
            { name: "Ukraine", pot: "UEFA Path B", kita: "EU", code: "ua" }, { name: "Sweden", pot: "UEFA Path B", kita: "EU", code: "se" }, { name: "Poland", pot: "UEFA Path B", kita: "EU", code: "pl" }, { name: "Albania", pot: "UEFA Path B", kita: "EU", code: "al" },
            { name: "Türkiye", pot: "UEFA Path C", kita: "EU", code: "tr" }, { name: "Romania", pot: "UEFA Path C", kita: "EU", code: "ro" }, { name: "Slovakia", pot: "UEFA Path C", kita: "EU", code: "sk" }, { name: "Kosovo", pot: "UEFA Path C", kita: "EU", code: "xk" },
            { name: "Denmark", pot: "UEFA Path D", kita: "EU", code: "dk" }, { name: "N. Macedonia", pot: "UEFA Path D", kita: "EU", code: "mk" }, { name: "Czechia", pot: "UEFA Path D", kita: "EU", code: "cz" }, { name: "Ireland", pot: "UEFA Path D", kita: "EU",code: "ie" },
            { name: "Jamaica", pot: "FIFA PO 1", kita: "NA", code: "jm" }, { name: "DR Congo", pot: "FIFA PO 1", kita: "AF", code: "cd" }, { name: "New Caledonia", pot: "FIFA PO 1", kita: "OC", code:"nc" },
            { name: "Iraq", pot: "FIFA PO 2", kita: "AS", code: "iq" }, { name: "Bolivia", pot: "FIFA PO 2", kita: "SA", code: "bo" }, { name: "Suriname", pot: "FIFA PO 2", kita: "NA", code: "sr" }
        ];

        const referenceOpponents = [
            "Mexico", "Canada", "USA", "Spain", "Argentina", "France", "England", "Brazil", "Portugal", "Netherlands", "Belgium", "Germany",
            "Croatia", "Morocco", "Colombia", "Uruguay", "Switzerland", "Japan", "Senegal", "IR Iran", "Korea Republic", "Ecuador", "Austria", "Australia",
            "Norway", "Panama", "Egypt", "Algeria", "Scotland", "Paraguay", "Tunisia", "Côte d'Ivoire", "Uzbekistan", "Qatar", "Saudi Arabia", "South Africa",
            "Jordan", "Cabo Verde", "Ghana", "Curaçao", "Haiti", "New Zealand",
            "UEFA Path A", "UEFA Path B", "UEFA Path C", "UEFA Path D", "FIFA PO 1", "FIFA PO 2"
        ];

        document.addEventListener('DOMContentLoaded', () => {
            const listContainer = document.getElementById('countryList');
            allCountries.sort((a, b) => a.name.localeCompare(b.name));

            if (typeof analysisData === 'undefined') {
                document.getElementById('dataWarning').style.display = 'block';
            }

            allCountries.forEach(country => {
                const div = document.createElement('div');
                const isPlayoff = country.pot.includes("Path") || country.pot.includes("FIFA");
                div.className = `country-item p-3 border-b border-gray-800 flex justify-between items-center text-gray-200 hover:pl-5 transition-all`;
                
                let badgeClass = isPlayoff ? "bg-gray-800/50 text-gray-600 border border-gray-700/30" : "bg-yellow-900/30 text-yellow-500 border border-yellow-700/30";
                
                let nameHtml = `<span class="font-medium text-sm text-gray-200">${country.name}</span>`;
                if (country.name === "Türkiye") nameHtml = `<span class="font-bold text-sm text-green-400">Türkiye</span>`;
                if (isPlayoff) nameHtml += ` <span class="text-[9px] text-gray-600 italic leading-none mt-0.5">if qualifies</span>`;

                let flagImg = `<img src="https://flagcdn.com/w40/${country.code}.png" class="w-6 h-4 object-cover rounded-sm shadow-sm mr-3">`;
                
                div.innerHTML = `
                    <div class="flex items-center">
                        ${flagImg}
                        <div class="flex flex-col">${nameHtml}</div>
                    </div>
                    <span class="text-[9px] px-2 py-1 rounded ${badgeClass} truncate max-w-[80px] text-center" title="${country.pot}">${country.pot.replace("Pot ", "P")}</span>
                `;
                div.onclick = () => selectCountry(country, div);
                listContainer.appendChild(div);
            });
        });

        function filterCountries() {
            const input = document.getElementById('searchInput');
            const filter = input.value.toLowerCase();
            const items = document.getElementsByClassName('country-item');
            for (let i = 0; i < items.length; i++) {
                const txtValue = items[i].textContent || items[i].innerText;
                if (txtValue.toLowerCase().indexOf(filter) > -1) items[i].style.display = "";
                else items[i].style.display = "none";
            }
        }

        function selectCountry(country, element) {
            document.querySelectorAll('.country-item').forEach(el => el.classList.remove('active'));
            element.classList.add('active');

            document.getElementById('selectedCountryName').innerText = country.name;
            document.getElementById('selectedCountryPot').innerText = `${country.pot} | ${country.kita}`;
            
            const headerIconContainer = document.querySelector('#headerSection div:first-child');
            headerIconContainer.className = "w-24 h-24 rounded-full bg-slate-800 flex-shrink-0 flex items-center justify-center shadow-2xl border-4 border-slate-700 overflow-hidden relative";
            headerIconContainer.innerHTML = `<img src="https://flagcdn.com/h120/${country.code}.png" class="w-full h-full object-cover">`;

            document.getElementById('emptyState').classList.add('hidden');
            document.getElementById('statsSection').classList.remove('hidden');

            const tbody = document.getElementById('opponentsTableBody');
            tbody.innerHTML = '';

            if (typeof analysisData === 'undefined') {
                tbody.innerHTML = '<tr><td colspan="3" class="p-4 text-center text-red-400">Error: analysis_data.js not loaded.</td></tr>';
                return;
            }

            const activeData = analysisData[country.name] || [];
            let fullList = [];

            referenceOpponents.forEach(oppName => {
                if (oppName === country.name) return;
                if (country.pot.includes(oppName)) return; 

                const found = activeData.find(d => d.name.toUpperCase() === oppName.toUpperCase());
                
                if (found) {
                    fullList.push(found);
                } else {
                    let oppKita = "---";
                    if(oppName.includes("UEFA")) oppKita = "EU";
                    else if(oppName.includes("FIFA")) oppKita = "MIX";
                    else {
                        const cInfo = allCountries.find(c => c.name === oppName);
                        if(cInfo) oppKita = cInfo.kita;
                    }
                    fullList.push({ name: oppName, kita: oppKita, prob: 0 });
                }
            });

            fullList.sort((a, b) => b.prob - a.prob);

            if (activeData.length === 0) {
                 tbody.innerHTML = `
                    <tr>
                        <td colspan="3" class="p-8 text-center">
                            <div class="flex flex-col items-center justify-center text-gray-500">
                                <i class="fas fa-hourglass-half text-4xl mb-3 text-yellow-600/50"></i>
                                <span class="text-lg font-medium">Coming Soon...</span>
                                <span class="text-xs mt-1 text-gray-600">Analysis for this country is being prepared.</span>
                            </div>
                        </td>
                    </tr>`;
                 return;
            }

            fullList.forEach(op => {
                const barWidth = Math.min(op.prob * 4, 100);
                
                let oppContinent = op.kita || "---";
                let oppCode = "";
                
                if (oppContinent === "---") {
                     if(op.name.includes("UEFA")) { oppContinent = "EU"; }
                     else if(op.name.includes("FIFA")) { oppContinent = "MIX"; }
                     else {
                        const cInfo = allCountries.find(c => c.name === op.name);
                        if(cInfo) { oppContinent = cInfo.kita; oppCode = cInfo.code; }
                     }
                } else {
                    const cInfo = allCountries.find(c => c.name === op.name);
                    if(cInfo) oppCode = cInfo.code;
                }

                let oppFlagHtml = "";
                if (oppCode) {
                    oppFlagHtml = `<img src="https://flagcdn.com/w20/${oppCode}.png" class="w-5 h-3.5 object-cover rounded-[1px] shadow-sm inline-block mr-2">`;
                } else {
                    oppFlagHtml = `<i class="fas fa-users text-gray-500 text-xs mr-2 w-5 text-center"></i>`;
                }

                const rowOpacity = op.prob === 0 ? "opacity-40 grayscale" : "opacity-100";
                const probColor = op.prob === 0 ? "text-gray-600" : "text-yellow-500";

                const row = document.createElement('tr');
                row.className = `border-b border-gray-700/50 hover:bg-slate-700/30 transition ${rowOpacity}`;
                row.innerHTML = `
                    <td class="py-3 px-4 font-medium text-gray-300 flex items-center">
                        ${oppFlagHtml}
                        <span class="truncate max-w-[150px] sm:max-w-none">${op.name}</span>
                    </td>
                    <td class="py-3 px-4 text-xs text-gray-500 font-mono text-center">${oppContinent}</td>
                    <td class="py-3 px-4">
                        <div class="flex items-center gap-3">
                            <span class="text-sm font-bold ${probColor} w-12 text-right">${op.prob}%</span>
                            <div class="w-full bg-gray-700 rounded-full h-2">
                                <div class="bg-yellow-500 h-2 rounded-full progress-bar shadow-[0_0_10px_rgba(234,179,8,0.5)]" style="width: ${barWidth}%"></div>
                            </div>
                        </div>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }
    </script>
</body>
</html>